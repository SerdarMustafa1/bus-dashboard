(this.webpackJsonpclient=this.webpackJsonpclient||[]).push([[3],{325:function(e,t,a){"use strict";a.r(t);var n=a(1),s=a.n(n),i=a(11),l=a(12),c=a(13),r=a(15),o=a(14),m=a(0),d=a.n(m),h=a(17),p=a(7),u=a(33),g=a(168),v=a(8),f=a(3),b=a(116),E=a(24),y=a(70),x=a(21),w=a.n(x),k=a(87),S=function(e){Object(r.a)(a,e);var t=Object(o.a)(a);function a(){var e;Object(l.a)(this,a);for(var n=arguments.length,s=new Array(n),i=0;i<n;i++)s[i]=arguments[i];return(e=t.call.apply(t,[this].concat(s))).state={campaign:{},loaded:!1,selected:"",progress:{},index:0,lightbox:!1},e.controller=new AbortController,e.handleSelection=function(t){e.state.selected!==t?e.setState({selected:t}):e.setState({selected:""})},e.openLightBox=function(){var t=e.props.t;e.state.campaign&&e.state.campaign.pictures&&e.state.campaign.pictures.length>0?e.setState({lightbox:!0}):w.a.fire({icon:"info",title:t("db.campaign.images.info.empty.title"),text:t("db.campaign.images.info.empty.text"),showConfirmButton:!1,timer:3e3})},e}return Object(c.a)(a,[{key:"componentWillUnmount",value:function(){this.controller.abort()}},{key:"componentDidMount",value:function(){var e=Object(i.a)(s.a.mark((function e(){var t,a,n;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t='query{campaign(_id:"'.concat(this.props.match.params.id,'"){\n            _id name client{_id company}creator{_id name}budget startDate endDate created_at cities{name latitude longitude}\n            pictures { path thumbnail created_at }\n            placements{_id place{name} installs{installed vehicle{_id city{name}operator{company operatorId}}created_at count}\n      count isPublic}}}'),e.prev=1,e.next=4,Object(h.a)(t,this.controller.signal,this.props.token);case 4:a=e.sent,(n=a.campaign)?this.setState({campaign:n,loaded:!0}):this.setState({loaded:!0}),e.next=13;break;case 9:e.prev=9,e.t0=e.catch(1),console.log("Ohnoo, ",e.t0.toString()),this.setState({loaded:!0});case 13:case"end":return e.stop()}}),e,this,[[1,9]])})));return function(){return e.apply(this,arguments)}}()},{key:"getMapData",value:function(){return{height:530,query:'query{campaignVehicles(_id: "'.concat(this.state.campaign._id,'"){_id haveAds longitude latitude}}'),latitude:this.state.campaign.cities[0].latitude,longitude:this.state.campaign.cities[0].longitude,zoom:7,getData:function(e){return e.campaignVehicles},smooth:!0,token:this.props.token,details:!1}}},{key:"totalFleets",value:function(){var e,t=[],a=Object(u.a)(this.state.campaign.placements);try{for(a.s();!(e=a.n()).done;){var n,s=e.value,i=Object(u.a)(s.installs);try{for(i.s();!(n=i.n()).done;){var l=n.value;t.push(l.vehicle._id)}}catch(c){i.e(c)}finally{i.f()}}}catch(c){a.e(c)}finally{a.f()}return new Set(t).size}},{key:"timeLeftPercent",value:function(){return((new Date).getTime()-this.state.campaign.startDate)/(this.state.campaign.endDate-this.state.campaign.startDate)*100}},{key:"render",value:function(){var e=this,t=this.props.t;if(this.state.loaded&&0===Object.keys(this.state.campaign).length)return d.a.createElement("div",{className:"container-fluid text-center"},d.a.createElement("h3",{className:"text-white"},t("db.campaign.404")));var a=this.state.campaign.pictures,n=this.state.index;return d.a.createElement("div",{className:"container-fluid"},this.state.lightbox&&d.a.createElement(b.a,{mainSrc:a[n].path,nextSrc:a[(n+1)%a.length].path,prevSrc:a[(n+a.length-1)%a.length].path,onCloseRequest:function(){return e.setState({lightbox:!1})},onMovePrevRequest:function(){return e.setState({index:(n+a.length-1)%a.length})},onMoveNextRequest:function(){return e.setState({index:(n+1)%a.length})}}),d.a.createElement(v.a,{className:"border-bottom mb-4"},d.a.createElement(f.a,{xs:12},d.a.createElement("h3",{className:"text-white"},!this.state.loaded&&"Loading...",this.state.loaded&&this.state.campaign.client.company+": "+this.state.campaign.name,this.state.loaded&&d.a.createElement("div",{className:"float-right campview-images",onClick:this.openLightBox},d.a.createElement("i",{className:"ion ion-images"})," Images"," ",d.a.createElement(y.a,{variant:a.length?"success":"danger"},a.length))))),d.a.createElement(v.a,null,d.a.createElement(f.a,{md:12,xl:4,className:"mb-4"},d.a.createElement(k.g,{data:{loaded:this.state.loaded,startDate:this.state.loaded&&this.state.campaign.startDate,endDate:this.state.loaded&&this.state.campaign.endDate,now:this.state.loaded&&this.timeLeftPercent()}})),d.a.createElement(f.a,{md:6,xl:4},d.a.createElement(k.c,{data:{loaded:this.state.loaded,cities:this.state.loaded&&this.state.campaign.cities.map((function(e){return e.name})).join(", "),vehicles:this.state.loaded&&this.totalFleets()}})),d.a.createElement(f.a,{md:6,xl:4},d.a.createElement(k.f,{data:{loaded:this.state.loaded,creator:this.state.loaded&&this.state.campaign.creator,date:this.state.loaded&&this.state.campaign.created_at}}))),d.a.createElement(v.a,null,d.a.createElement(f.a,{xl:8},d.a.createElement(k.e,{data:{loaded:this.state.loaded,mapData:this.state.loaded&&this.getMapData(),selected:this.state.selected,handleSelection:this.handleSelection}})),d.a.createElement(f.a,{xl:4},d.a.createElement(k.d,{data:{loaded:this.state.loaded,placements:this.state.loaded&&this.state.campaign.placements}}))),d.a.createElement(v.a,null,this.state.loaded&&d.a.createElement(f.a,{xl:8},d.a.createElement(k.a,{data:{placements:this.state.campaign.placements,rowCallback:function(t,a){return t.onclick=function(){return e.handleSelection(a._id)}}}})),this.state.selected&&d.a.createElement(f.a,{xl:4},d.a.createElement(g.a,{data:this.state.selected,token:this.props.token}))))}}]),a}(m.Component);S.contextType=E.a;var N=Object(p.b)()(S),j=a(109),O=a(6),D=a(20),_=a(23),C=a(45),L=a(182),q=a(117),P=a.n(q),A=Object(p.b)()((function(e){var t=e.t,a=e.token,n=e.match;return d.a.createElement("div",{id:"wrapper"},d.a.createElement("div",{className:"content-page",style:{marginLeft:0}},d.a.createElement("div",{className:"content"},d.a.createElement("div",{className:"page-content-wrapper",style:{paddingTop:0}},d.a.createElement(N,{token:a,match:n,client:!0}))),d.a.createElement("footer",{className:"footer"},"\xa9 ",t("company.name"))))})),M=function(e){var t=e.type,a=e.hide,n=e.message;return d.a.createElement(j.a,{className:"mt-2",variant:t,onClose:function(){return a()},dismissible:!0},n)},B=function(e){Object(r.a)(a,e);var t=Object(o.a)(a);function a(){var e;Object(l.a)(this,a);for(var n=arguments.length,c=new Array(n),r=0;r<n;r++)c[r]=arguments[r];return(e=t.call.apply(t,[this].concat(c))).state={password:"",logging:null,invalid:!1,connection:!1,token:""},e.controller=new AbortController,e.handleSubmit=function(){var t=Object(i.a)(s.a.mark((function t(a){var n,i,l;return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(a.preventDefault(),e.state.password){t.next=3;break}return t.abrupt("return");case 3:return e.setState({logging:!0}),n='query{campaignLogin(_id:"'.concat(e.props.match.params.id,'",password:"').concat(e.state.password,'")}'),t.prev=5,t.next=8,Object(h.a)(n,e.controller.signal);case 8:i=t.sent,(l=i.campaignLogin)?e.setState({token:l}):e.setState({invalid:!0,logging:!1}),t.next=16;break;case 13:t.prev=13,t.t0=t.catch(5),"SyntaxError"===t.t0.name?e.setState({connection:!0,logging:!1}):e.setState({invalid:!0,logging:!1});case 16:case"end":return t.stop()}}),t,null,[[5,13]])})));return function(e){return t.apply(this,arguments)}}(),e.handlePassChange=function(t){return e.setState({password:t.target.value})},e}return Object(c.a)(a,[{key:"componentWillUnmount",value:function(){this.controller.abort()}},{key:"render",value:function(){var e=this;if(this.state.token)return d.a.createElement(A,{token:this.state.token,match:this.props.match});var t=this.props.t;return d.a.createElement("div",{className:"wrapper-page"},d.a.createElement(O.a,null,d.a.createElement(O.a.Body,null,d.a.createElement("div",{className:"p-2"},d.a.createElement("h3",{className:"text-center m-0"},d.a.createElement("a",{href:"/",className:"logo logo-admin"},d.a.createElement("img",{src:P.a,height:"100",alt:"logo"}))),this.state.invalid&&d.a.createElement(M,{message:t("login.failed.invalid"),hide:function(){return e.setState({invalid:!1})},type:"danger"}),this.state.connection&&d.a.createElement(M,{message:t("login.failed.connection"),hide:function(){return e.setState({connection:!1})},type:"warning"}),d.a.createElement(D.a,{onSubmit:this.handleSubmit},d.a.createElement(D.a.Group,null,d.a.createElement(D.a.Label,null,t("login.password.label")),d.a.createElement(D.a.Control,{pattern:".{6,}",type:"password",placeholder:t("login.password.placeholder"),value:this.state.password,onChange:this.handlePassChange,required:!0})),d.a.createElement(D.a.Group,{className:"m-t-20"},d.a.createElement(f.a,{xs:12,className:"text-right"},d.a.createElement(_.a,{variant:"primary",className:"w-md waves-effect waves-light",type:"submit"},this.state.logging&&d.a.createElement(C.a,{animation:"border",size:"sm",className:"mr-1"}),t("login.button.submit.label"))))),d.a.createElement(v.a,null,d.a.createElement(f.a,{className:"m-t-20 p-0"}),d.a.createElement(f.a,{xs:2,className:"m-t-20 p-0"},d.a.createElement(L.a,null)))))))}}]),a}(m.Component);t.default=Object(p.b)()(B)}}]);
//# sourceMappingURL=3.2ee0ed4a.chunk.js.map